<!-- ============================================================================ -->
<!-- ğŸ” DOSYA DOÄRULAMA SÄ°STEMÄ° -->
<!-- Bu bÃ¶lÃ¼mÃ¼ previewSection'Ä±n kapanÄ±ÅŸ </div> etiketinden SONRA -->
<!-- ama dn-wrap kapanÄ±ÅŸÄ±ndan (en son </div>) Ã–NCE ekleyin -->
<!-- ============================================================================ -->

<div class="dn-verify-section" id="verifySection">
  <div class="dn-verify-header">
    <div class="dn-verify-badge">VERIFICATION TOOL</div>
    <h2 class="dn-verify-title">Dosya DoÄŸrulama</h2>
    <p class="dn-verify-subtitle">Elinizdeki dosyanÄ±n daha Ã¶nce mÃ¼hÃ¼rlenip mÃ¼hÃ¼rlenmediÄŸini kontrol edin</p>
  </div>

  <div class="dn-verify-explainer">
    <div class="dn-verify-explainer-icon">ğŸ”</div>
    <div class="dn-verify-explainer-content">
      <div class="dn-verify-explainer-title">NasÄ±l Ã‡alÄ±ÅŸÄ±r?</div>
      <div class="dn-verify-explainer-text">
        Bir dosyayÄ± buraya sÃ¼rÃ¼kleyin. Sistem otomatik olarak SHA-512 hash'ini hesaplayÄ±p 
        Ä°lhanArt veri tabanÄ±nda arar. EÄŸer dosya daha Ã¶nce mÃ¼hÃ¼rlenmiÅŸse, tÃ¼m detaylarÄ±nÄ± gÃ¶receksiniz.
      </div>
    </div>
  </div>

  <div class="dn-verify-drop-zone" id="verifyDropZone">
    <div class="dn-verify-drop-icon">ğŸ“‚</div>
    <div class="dn-verify-drop-title">DosyayÄ± SÃ¼rÃ¼kle & BÄ±rak</div>
    <div class="dn-verify-drop-subtitle">veya tÄ±klayÄ±p seÃ§in (herhangi bir dosya tÃ¼rÃ¼)</div>
    <div class="dn-verify-drop-meta" id="verifyFileMeta"></div>
  </div>
  <input type="file" id="verifyFileInput" class="dn-hidden-input" />

  <!-- Loading State -->
  <div class="dn-verify-loading" id="verifyLoading" style="display: none;">
    <div class="dn-verify-loading-spinner"></div>
    <div class="dn-verify-loading-text">Hash hesaplanÄ±yor ve veritabanÄ±nda aranÄ±yor...</div>
  </div>

  <!-- Result: NOT FOUND -->
  <div class="dn-verify-result dn-verify-not-found" id="verifyNotFound" style="display: none;">
    <div class="dn-verify-result-icon">âŒ</div>
    <div class="dn-verify-result-title">KayÄ±t BulunamadÄ±</div>
    <div class="dn-verify-result-desc">
      Bu dosya Ä°lhanArt sisteminde mÃ¼hÃ¼rlenmemiÅŸ. Hash hesaplamasÄ± baÅŸarÄ±lÄ± oldu ama veritabanÄ±nda eÅŸleÅŸen bir kayÄ±t yok.
    </div>
    <div class="dn-verify-hash-display">
      <div class="dn-verify-hash-label">Hesaplanan SHA-512:</div>
      <div class="dn-verify-hash-value" id="verifyComputedHash"></div>
    </div>
  </div>

  <!-- Result: FOUND -->
  <div class="dn-verify-result dn-verify-found" id="verifyFound" style="display: none;">
    <div class="dn-verify-result-icon">âœ…</div>
    <div class="dn-verify-result-title">Dosya DoÄŸrulandÄ±!</div>
    <div class="dn-verify-result-desc">
      Bu dosya Ä°lhanArt sisteminde kayÄ±tlÄ±. AÅŸaÄŸÄ±da orijinal mÃ¼hÃ¼rleme bilgilerini gÃ¶rebilirsiniz.
    </div>

    <div class="dn-verify-cert-card">
      <div class="dn-verify-cert-header">
        <div class="dn-verify-cert-badge" id="verifyCertBadge">POART-XXXXXXXX</div>
        <div class="dn-verify-cert-visibility" id="verifyCertVisibility">ğŸŒ Herkese AÃ§Ä±k</div>
      </div>

      <div class="dn-verify-cert-grid">
        <div class="dn-verify-cert-item">
          <div class="dn-verify-cert-label">Eser AdÄ±</div>
          <div class="dn-verify-cert-value" id="verifyCertTitle">-</div>
        </div>
        <div class="dn-verify-cert-item">
          <div class="dn-verify-cert-label">SanatÃ§Ä±</div>
          <div class="dn-verify-cert-value" id="verifyCertCreator">-</div>
        </div>
        <div class="dn-verify-cert-item">
          <div class="dn-verify-cert-label">MÃ¼hÃ¼rleme Tarihi</div>
          <div class="dn-verify-cert-value" id="verifyCertDate">-</div>
        </div>
        <div class="dn-verify-cert-item">
          <div class="dn-verify-cert-label">Konum</div>
          <div class="dn-verify-cert-value" id="verifyCertLocation">-</div>
        </div>
        <div class="dn-verify-cert-item">
          <div class="dn-verify-cert-label">IP (Maskeli)</div>
          <div class="dn-verify-cert-value" id="verifyCertIP">-</div>
        </div>
        <div class="dn-verify-cert-item">
          <div class="dn-verify-cert-label">Cihaz</div>
          <div class="dn-verify-cert-value" id="verifyCertDevice">-</div>
        </div>
      </div>

      <div class="dn-verify-hash-display">
        <div class="dn-verify-hash-label">SHA-256 (Orijinal):</div>
        <div class="dn-verify-hash-value" id="verifySHA256"></div>
      </div>

      <div class="dn-verify-hash-display" style="margin-top: 12px;">
        <div class="dn-verify-hash-label">SHA-512 (Orijinal MÃ¼hÃ¼r):</div>
        <div class="dn-verify-hash-value" id="verifySHA512"></div>
      </div>

      <div class="dn-verify-cert-footer">
        <a href="#" id="verifyCertLink" target="_blank" class="dn-verify-cert-link">
          ğŸ“œ DoÄŸrulama Linki
        </a>
      </div>
    </div>
  </div>
</div>

<!-- ============================================================================ -->
<!-- STÄ°LLER - Bu <style> bloÄŸunu mevcut </style> kapanÄ±ÅŸÄ±ndan Ã–NCE ekleyin -->
<!-- ============================================================================ -->

<style>
/* Verification Section Base */
.dn-verify-section {
  margin-top: 48px;
  padding-top: 48px;
  border-top: 3px solid rgba(5, 150, 105, 0.15);
  animation: fadeInUp 0.6s ease;
}

@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

.dn-verify-header {
  text-align: center;
  margin-bottom: 32px;
}

.dn-verify-badge {
  display: inline-block;
  padding: 6px 16px;
  background: linear-gradient(135deg, #f59e0b, #d97706);
  color: #fffbeb;
  font-size: 11px;
  font-weight: 800;
  letter-spacing: 2.5px;
  border-radius: 100px;
  margin-bottom: 16px;
  box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
}

.dn-verify-title {
  font-weight: 900;
  font-size: 32px;
  background: linear-gradient(135deg, var(--dn-gray-800) 0%, #d97706 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  letter-spacing: -0.03em;
  margin: 0 0 12px 0;
}

.dn-verify-subtitle {
  margin: 0;
  color: var(--dn-gray-500);
  font-size: 15px;
  line-height: 1.6;
  font-weight: 500;
}

/* Explainer Box */
.dn-verify-explainer {
  display: flex;
  align-items: flex-start;
  gap: 18px;
  background: linear-gradient(135deg, rgba(251, 191, 36, 0.08), rgba(245, 158, 11, 0.05));
  border: 2px solid rgba(251, 191, 36, 0.2);
  border-left: 5px solid #fbbf24;
  border-radius: 18px;
  padding: 24px;
  margin-bottom: 28px;
}

.dn-verify-explainer-icon {
  font-size: 36px;
  flex-shrink: 0;
}

.dn-verify-explainer-content {
  flex: 1;
}

.dn-verify-explainer-title {
  font-size: 16px;
  font-weight: 800;
  color: var(--dn-gray-800);
  margin-bottom: 8px;
}

.dn-verify-explainer-text {
  font-size: 14px;
  color: var(--dn-gray-600);
  line-height: 1.7;
}

/* Drop Zone */
.dn-verify-drop-zone {
  border: 3px dashed rgba(251, 191, 36, 0.35);
  background: linear-gradient(145deg, #ffffff 0%, #fef3c7 25%, rgba(254, 243, 199, 0.4) 100%);
  border-radius: 20px;
  padding: 52px 28px;
  text-align: center;
  cursor: pointer;
  transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
  margin-bottom: 28px;
  min-height: 140px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.dn-verify-drop-zone:hover {
  border-color: #fbbf24;
  background: linear-gradient(145deg, #fffbeb 0%, #fef3c7 50%, #fde68a 100%);
  transform: translateY(-3px);
  box-shadow: 0 15px 35px rgba(251, 191, 36, 0.18);
}

.dn-verify-drop-zone.is-over {
  border-color: #f59e0b;
  border-style: solid;
  background: linear-gradient(145deg, #fef3c7 0%, #fde68a 100%);
  box-shadow: 0 0 0 5px rgba(251, 191, 36, 0.2);
  transform: scale(1.02);
}

.dn-verify-drop-icon {
  font-size: 52px;
  margin-bottom: 10px;
}

.dn-verify-drop-title {
  font-size: 19px;
  font-weight: 800;
  color: var(--dn-gray-700);
  margin-bottom: 6px;
}

.dn-verify-drop-subtitle {
  font-size: 14px;
  color: var(--dn-gray-500);
  font-weight: 500;
}

.dn-verify-drop-meta {
  margin-top: 14px;
  font-size: 13px;
  font-weight: 700;
  color: #d97706;
  background: rgba(251, 191, 36, 0.15);
  padding: 6px 14px;
  border-radius: 8px;
}

/* Loading State */
.dn-verify-loading {
  text-align: center;
  padding: 52px 28px;
  background: linear-gradient(145deg, #ffffff, var(--dn-gray-50));
  border-radius: 18px;
  border: 2px solid var(--dn-gray-200);
  margin-bottom: 28px;
}

.dn-verify-loading-spinner {
  width: 52px;
  height: 52px;
  border: 5px solid var(--dn-gray-200);
  border-top-color: #fbbf24;
  border-radius: 50%;
  animation: spin 0.9s linear infinite;
  margin: 0 auto 18px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.dn-verify-loading-text {
  font-size: 15px;
  color: var(--dn-gray-600);
  font-weight: 600;
}

/* Result States */
.dn-verify-result {
  border-radius: 20px;
  padding: 36px 32px;
  text-align: center;
  animation: slideUpFade 0.5s ease;
  margin-bottom: 28px;
}

@keyframes slideUpFade {
  from { opacity: 0; transform: translateY(40px); }
  to { opacity: 1; transform: translateY(0); }
}

.dn-verify-not-found {
  background: linear-gradient(145deg, #fef2f2, #fee2e2);
  border: 3px solid #fca5a5;
}

.dn-verify-found {
  background: linear-gradient(145deg, #f0fdf4, #dcfce7);
  border: 3px solid #86efac;
}

.dn-verify-result-icon {
  font-size: 72px;
  margin-bottom: 18px;
}

.dn-verify-result-title {
  font-size: 26px;
  font-weight: 900;
  margin-bottom: 14px;
  letter-spacing: -0.02em;
}

.dn-verify-not-found .dn-verify-result-title {
  background: linear-gradient(135deg, #dc2626, #ef4444);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.dn-verify-found .dn-verify-result-title {
  background: linear-gradient(135deg, #16a34a, #22c55e);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.dn-verify-result-desc {
  font-size: 14px;
  color: var(--dn-gray-600);
  line-height: 1.8;
  margin-bottom: 28px;
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}

/* Hash Display */
.dn-verify-hash-display {
  background: rgba(0, 0, 0, 0.04);
  border: 2px solid rgba(0, 0, 0, 0.08);
  border-radius: 14px;
  padding: 18px 20px;
  text-align: left;
  margin-top: 24px;
}

.dn-verify-hash-label {
  font-size: 11px;
  font-weight: 800;
  color: var(--dn-gray-600);
  text-transform: uppercase;
  letter-spacing: 0.8px;
  margin-bottom: 10px;
}

.dn-verify-hash-value {
  font-family: 'Courier New', monospace;
  font-size: 11px;
  color: var(--dn-gray-800);
  word-break: break-all;
  line-height: 1.7;
  background: rgba(255, 255, 255, 0.7);
  padding: 12px;
  border-radius: 8px;
  border: 1px solid rgba(0, 0, 0, 0.06);
}

/* Certificate Card */
.dn-verify-cert-card {
  background: #ffffff;
  border: 3px solid #86efac;
  border-radius: 20px;
  padding: 28px;
  margin-top: 28px;
  text-align: left;
  box-shadow: 0 8px 30px rgba(5, 150, 105, 0.12);
}

.dn-verify-cert-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-bottom: 18px;
  margin-bottom: 24px;
  border-bottom: 3px solid #d1fae5;
}

.dn-verify-cert-badge {
  font-family: 'Courier New', monospace;
  font-size: 14px;
  font-weight: 900;
  color: var(--dn-primary-darker);
  background: linear-gradient(135deg, rgba(5, 150, 105, 0.15), rgba(16, 185, 129, 0.1));
  padding: 8px 16px;
  border-radius: 10px;
  border: 2px solid rgba(5, 150, 105, 0.25);
}

.dn-verify-cert-visibility {
  font-size: 13px;
  font-weight: 700;
  color: var(--dn-gray-600);
  background: var(--dn-gray-50);
  padding: 6px 12px;
  border-radius: 8px;
}

.dn-verify-cert-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 18px;
  margin-bottom: 24px;
}

.dn-verify-cert-item {
  background: linear-gradient(135deg, #f0fdf4 0%, #ffffff 100%);
  padding: 16px;
  border-radius: 12px;
  border-left: 4px solid var(--dn-primary);
  transition: all 0.3s ease;
}

.dn-verify-cert-item:hover {
  transform: translateX(4px);
  box-shadow: 0 4px 15px rgba(5, 150, 105, 0.1);
}

.dn-verify-cert-label {
  font-size: 10px;
  font-weight: 800;
  color: var(--dn-primary);
  text-transform: uppercase;
  letter-spacing: 0.8px;
  margin-bottom: 8px;
}

.dn-verify-cert-value {
  font-size: 14px;
  font-weight: 700;
  color: var(--dn-gray-800);
  line-height: 1.4;
}

.dn-verify-cert-footer {
  margin-top: 24px;
  padding-top: 20px;
  border-top: 2px solid #d1fae5;
  text-align: center;
}

.dn-verify-cert-link {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  padding: 14px 28px;
  background: linear-gradient(135deg, var(--dn-primary-dark), var(--dn-primary));
  color: white;
  font-weight: 800;
  font-size: 14px;
  text-decoration: none;
  border-radius: 12px;
  transition: all 0.3s ease;
  box-shadow: 0 6px 20px rgba(5, 150, 105, 0.25);
}

.dn-verify-cert-link:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 30px rgba(5, 150, 105, 0.35);
  background: linear-gradient(135deg, var(--dn-primary), var(--dn-primary-light));
}

/* Responsive */
@media (max-width: 768px) {
  .dn-verify-cert-grid {
    grid-template-columns: 1fr;
  }
  .dn-verify-title {
    font-size: 26px;
  }
  .dn-verify-cert-header {
    flex-direction: column;
    gap: 12px;
    align-items: flex-start;
  }
}
</style>

<!-- ============================================================================ -->
<!-- JAVASCRIPT - Bu <script> bloÄŸunu en son </script> kapanÄ±ÅŸÄ±ndan HEMEN Ã–NCE ekleyin -->
<!-- NOT: Mevcut script'in kapanÄ±ÅŸÄ±ndan Ã–NCE, yani ")();" satÄ±rÄ±ndan Ã¶nce ekleyin -->
<!-- ============================================================================ -->

<script>
// ===== VERIFICATION SYSTEM =====
// Bu kod mevcut script iÃ§inde, sb deÄŸiÅŸkeni tanÄ±mlandÄ±ktan SONRA eklenmelidir
(function initVerification() {
  const verifyDropZone = document.getElementById('verifyDropZone');
  const verifyFileInput = document.getElementById('verifyFileInput');
  const verifyFileMeta = document.getElementById('verifyFileMeta');
  const verifyLoading = document.getElementById('verifyLoading');
  const verifyNotFound = document.getElementById('verifyNotFound');
  const verifyFound = document.getElementById('verifyFound');

  // Result elements
  const verifyComputedHash = document.getElementById('verifyComputedHash');
  const verifySHA256 = document.getElementById('verifySHA256');
  const verifySHA512 = document.getElementById('verifySHA512');
  const verifyCertBadge = document.getElementById('verifyCertBadge');
  const verifyCertVisibility = document.getElementById('verifyCertVisibility');
  const verifyCertTitle = document.getElementById('verifyCertTitle');
  const verifyCertCreator = document.getElementById('verifyCertCreator');
  const verifyCertDate = document.getElementById('verifyCertDate');
  const verifyCertLocation = document.getElementById('verifyCertLocation');
  const verifyCertIP = document.getElementById('verifyCertIP');
  const verifyCertDevice = document.getElementById('verifyCertDevice');
  const verifyCertLink = document.getElementById('verifyCertLink');

  // Drag & Drop setup
  verifyDropZone.addEventListener('click', () => verifyFileInput.click());

  ['dragenter', 'dragover'].forEach(evt => {
    verifyDropZone.addEventListener(evt, (e) => {
      e.preventDefault();
      e.stopPropagation();
      verifyDropZone.classList.add('is-over');
    });
  });

  ['dragleave', 'drop'].forEach(evt => {
    verifyDropZone.addEventListener(evt, (e) => {
      e.preventDefault();
      e.stopPropagation();
      verifyDropZone.classList.remove('is-over');
    });
  });

  verifyDropZone.addEventListener('drop', (e) => {
    const file = e.dataTransfer.files && e.dataTransfer.files[0];
    if (file) handleVerifyFile(file);
  });

  verifyFileInput.addEventListener('change', (e) => {
    const file = e.target.files && e.target.files[0];
    if (file) handleVerifyFile(file);
  });

  async function handleVerifyFile(file) {
    // Reset UI
    verifyLoading.style.display = 'none';
    verifyNotFound.style.display = 'none';
    verifyFound.style.display = 'none';

    // Show file info
    const sizeMb = (file.size / (1024 * 1024)).toFixed(2);
    verifyFileMeta.textContent = `${file.name} â€¢ ${sizeMb} MB`;

    // Show loading
    verifyLoading.style.display = 'block';

    try {
      // Calculate hash
      const buffer = await file.arrayBuffer();
      const hashBuffer = await crypto.subtle.digest('SHA-512', buffer);
      const hash = Array.from(new Uint8Array(hashBuffer))
        .map(b => b.toString(16).padStart(2, '0'))
        .join('');

      console.log('ğŸ” Computed hash:', hash);

      // Search in Supabase
      const { data, error } = await sb
        .from('manifests')
        .select('*')
        .eq('sha512', hash)
        .single();

      verifyLoading.style.display = 'none';

      if (error || !data) {
        // NOT FOUND
        console.log('âŒ Not found in database');
        verifyComputedHash.textContent = hash;
        verifyNotFound.style.display = 'block';
        
        // Scroll to result
        setTimeout(() => {
          verifyNotFound.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 100);
      } else {
        // FOUND!
        console.log('âœ… Found in database:', data);
        displayVerificationResult(data, hash);
        verifyFound.style.display = 'block';
        
        // Scroll to result
        setTimeout(() => {
          verifyFound.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 100);
      }
    } catch (err) {
      console.error('Verification error:', err);
      verifyLoading.style.display = 'none';
      alert('DoÄŸrulama sÄ±rasÄ±nda hata oluÅŸtu: ' + err.message);
    }
  }

  function displayVerificationResult(record, hash) {
    // Badge & Visibility
    verifyCertBadge.textContent = record.cert_id;
    
    const visibilityIcons = {
      'private': 'ğŸ”’',
      'masked': 'ğŸ•¶ï¸',
      'public': 'ğŸŒ'
    };
    const visibilityLabels = {
      'private': 'Ã–zel (Private)',
      'masked': 'Maskeli (Masked)',
      'public': 'Herkese AÃ§Ä±k (Public)'
    };
    verifyCertVisibility.textContent = 
      `${visibilityIcons[record.visibility] || 'ğŸ”'} ${visibilityLabels[record.visibility] || record.visibility}`;

    // Basic Info
    verifyCertTitle.textContent = record.title || 'Ä°simsiz';
    verifyCertCreator.textContent = record.creator || 'Bilinmiyor';
    
    // Date
    try {
      const d = new Date(record.created_at);
      verifyCertDate.textContent = d.toLocaleDateString('tr-TR', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      }) + ' ' + d.toLocaleTimeString('tr-TR', {
        hour: '2-digit',
        minute: '2-digit'
      });
    } catch {
      verifyCertDate.textContent = record.created_at;
    }

    // Location & IP (visibility-dependent)
    if (record.visibility === 'private') {
      verifyCertLocation.textContent = 'Gizli';
      verifyCertIP.textContent = 'Gizli';
      verifyCertDevice.textContent = 'Gizli';
    } else if (record.visibility === 'masked') {
      verifyCertLocation.textContent = record.location_data || 'Gizli';
      verifyCertIP.textContent = record.origin_ip || 'Gizli';
      verifyCertDevice.textContent = 'Gizli';
    } else {
      verifyCertLocation.textContent = record.location_data || 'Belirtilmedi';
      verifyCertIP.textContent = record.origin_ip || 'Belirtilmedi';
      const deviceText = record.device_info || 'Belirtilmedi';
      verifyCertDevice.textContent = deviceText.length > 80 ? 
        deviceText.substring(0, 80) + '...' : 
        deviceText;
    }

    // Hashes
    verifySHA256.textContent = record.sha256 || 'Yok';
    verifySHA512.textContent = hash;

    // Verification Link
    verifyCertLink.href = `https://ilhanart.org/verify?id=${record.cert_id}`;
  }
})();
</script>
