<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PoArt Doğrulama (Verifier)</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&family=JetBrains+Mono&display=swap" rel="stylesheet">
    
    <style>
        :root { --emerald: #15803d; --emerald-soft: #dcfce7; --rose: #e11d48; --rose-soft: #ffe4e6; --slate: #1e293b; --bg: #ffffff; }
        body { font-family: 'Inter', sans-serif; background: transparent; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .verify-wrapper { width: 100%; max-width: 600px; background: var(--bg); border-radius: 24px; padding: 40px; box-shadow: 0 10px 40px rgba(0,0,0,0.08); border: 1px solid #e2e8f0; text-align: center; }
        h2 { margin: 0 0 10px 0; color: var(--slate); font-weight: 900; letter-spacing: -0.02em; }
        p { margin: 0 0 30px 0; color: #64748b; font-size: 14px; }
        .search-box { display: flex; gap: 10px; margin-bottom: 30px; }
        input { flex: 1; padding: 16px 20px; border-radius: 12px; border: 2px solid #e2e8f0; font-size: 16px; font-family: 'Inter', sans-serif; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--emerald); }
        button { background: var(--slate); color: white; border: none; padding: 0 30px; border-radius: 12px; font-weight: 700; cursor: pointer; transition: 0.2s; font-size: 14px; text-transform: uppercase; letter-spacing: 0.05em; }
        button:hover { background: black; transform: translateY(-2px); }
        .result-card { display: none; padding: 30px; border-radius: 20px; border: 2px solid transparent; animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .success { background: var(--emerald-soft); border-color: var(--emerald); color: var(--emerald); }
        .success .icon { font-size: 48px; margin-bottom: 10px; }
        .success h3 { margin: 10px 0; font-weight: 900; font-size: 20px; }
        .success .detail-row { background: rgba(255,255,255,0.6); padding: 10px; border-radius: 8px; margin-top: 5px; font-size: 14px; color: #064e3b; text-align: left; display: flex; justify-content: space-between; }
        .success .mono { font-family: 'JetBrains Mono', monospace; font-size: 12px; }
        .fail { background: var(--rose-soft); border-color: var(--rose); color: var(--rose); }
        .fail .icon { font-size: 48px; margin-bottom: 10px; }
        .fail h3 { font-weight: 900; font-size: 18px; margin: 0; }
        .fail p { color: #881337; margin-top: 5px; font-size: 13px; }
    </style>
</head>
<body>

<div class="verify-wrapper">
    <h2>Varlık Doğrulama</h2>
    <p>Sertifika ID, Eser Adı veya Mühür (Hash) girerek sorgulayın.</p>

    <div class="search-box">
        <input type="text" id="queryInput" placeholder="ID, İsim veya Hash yapıştırın...">
        <button onclick="verifyAsset()">SORGULA</button>
    </div>

    <div id="successCard" class="result-card success">
        <div class="icon">✅</div>
        <h3>DOĞRULANMIŞ VARLIK</h3>
        <div style="margin-bottom: 20px; font-size: 12px; opacity: 0.8;">OFFICIAL POART RECORD FOUND</div>
        
        <div class="detail-row"><span>Eser:</span><strong id="resTitle">-</strong></div>
        <div class="detail-row"><span>Sanatçı:</span><strong id="resCreator">-</strong></div>
        <div class="detail-row"><span>ID:</span><strong id="resId" class="mono">-</strong></div>
        <div class="detail-row" style="margin-top: 15px; border:1px solid #15803d;">
            <span>Mühür:</span><strong id="resHash" class="mono" style="font-size: 10px;">-</strong>
        </div>
    </div>

    <div id="failCard" class="result-card fail">
        <div class="icon">⛔</div>
        <h3>KAYIT BULUNAMADI</h3>
        <p>Girdiğiniz bilgilere ait mühürlenmiş bir varlık arşivde yok.</p>
    </div>
</div>

<script>
    const S_URL = 'https://immdfdvrwqcvgmflbgdr.supabase.co';
    const S_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImltbWRmZHZyd3FjdmdtZmxiZ2RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc4NzU0MTgsImV4cCI6MjA4MzQ1MTQxOH0.MN05h2FLVFb14P9Oi0y3g3euqZjzGdVslJay6aQ1HkE';
    
    const supabaseClient = supabase.createClient(S_URL, S_KEY);

    async function verifyAsset() {
        const input = document.getElementById('queryInput').value.trim();
        const successCard = document.getElementById('successCard');
        const failCard = document.getElementById('failCard');

        successCard.style.display = 'none';
        failCard.style.display = 'none';

        if (!input) return;

        // GÜNCELLENEN SORGU: Artık SHA256 ve SHA512 sütunlarına da bakıyor
        const { data, error } = await supabaseClient
            .from('manifests')
            .select('*')
            .or(`cert_id.ilike.%${input}%,title.ilike.%${input}%,sha256.ilike.%${input}%,sha512.ilike.%${input}%`)
            .limit(1);

        if (data && data.length > 0) {
            const item = data[0];
            document.getElementById('resTitle').innerText = item.title;
            document.getElementById('resCreator').innerText = item.creator;
            document.getElementById('resId').innerText = item.cert_id;
            const hashVal = item.sha512 || item.sha256 || 'Hash bilgisi eksik';
            document.getElementById('resHash').innerText = hashVal.substring(0, 20) + '...';
            
            successCard.style.display = 'block';
        } else {
            failCard.style.display = 'block';
        }
    }
</script>

</body>
</html>
