<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>[PoArt] Varlƒ±k Doƒürulama</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --emerald-50: #ecfdf5; --emerald-100: #d1fae5; --emerald-200: #a7f3d0;
      --emerald-400: #34d399; --emerald-500: #10b981; --emerald-600: #059669; --emerald-700: #047857;
      --red-50: #fef2f2; --red-500: #ef4444; --red-600: #dc2626; --red-700: #b91c1c;
      --slate-50: #f8fafc; --slate-100: #f1f5f9; --slate-200: #e2e8f0;
      --slate-300: #cbd5e1; --slate-400: #94a3b8; --slate-500: #64748b;
      --slate-600: #475569; --slate-800: #1e293b; --slate-900: #0f172a;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', -apple-system, sans-serif; background: transparent; color: var(--slate-800); }
    .page-wrapper { max-width: 800px; margin: 0 auto; padding: 10px 20px 50px; }

    .main-card { background: white; border-radius: 24px; padding: 35px; box-shadow: 0 10px 40px rgba(0,0,0,0.06); }

    .drop-zone { border: 2px dashed var(--slate-300); border-radius: 20px; padding: 50px 30px; text-align: center; cursor: pointer; transition: 0.3s; background: var(--slate-50); margin-bottom: 25px; }
    .drop-zone:hover { border-color: var(--emerald-500); background: var(--emerald-50); }
    .drop-zone.dragover { border-color: var(--emerald-600); background: var(--emerald-100); }
    .dz-icon { width: 70px; height: 70px; background: linear-gradient(135deg, var(--emerald-500), var(--emerald-600)); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 32px; margin: 0 auto 15px; box-shadow: 0 8px 25px rgba(16,185,129,0.3); }
    .dz-title { font-size: 18px; font-weight: 800; color: var(--slate-800); margin-bottom: 6px; }
    .dz-sub { font-size: 13px; color: var(--slate-500); margin-bottom: 15px; }
    .dz-formats { display: flex; flex-wrap: wrap; justify-content: center; gap: 6px; }
    .format-tag { font-size: 9px; font-weight: 700; padding: 5px 10px; background: white; color: var(--slate-600); border-radius: 15px; border: 1px solid var(--slate-200); }

    .divider { display: flex; align-items: center; gap: 15px; margin: 25px 0; }
    .divider::before, .divider::after { content: ""; flex: 1; height: 1px; background: var(--slate-200); }
    .divider span { font-size: 11px; font-weight: 700; color: var(--slate-400); letter-spacing: 0.1em; }

    .input-row { display: flex; gap: 12px; }
    .input-field { flex: 1; padding: 16px 20px; border: 2px solid var(--slate-200); border-radius: 14px; font-size: 15px; font-family: 'Inter'; outline: none; transition: 0.3s; background: var(--slate-50); }
    .input-field:focus { border-color: var(--emerald-500); background: white; box-shadow: 0 0 0 4px rgba(16,185,129,0.1); }
    .search-btn { padding: 16px 30px; background: linear-gradient(135deg, var(--slate-800), var(--slate-900)); color: white; border: none; border-radius: 14px; font-size: 13px; font-weight: 800; cursor: pointer; transition: 0.3s; }
    .search-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
    .search-btn:disabled { background: var(--slate-400); transform: none; }

    .loading { display: none; text-align: center; padding: 40px; }
    .loading.active { display: block; }
    .spinner { width: 40px; height: 40px; border: 3px solid var(--slate-200); border-top-color: var(--emerald-500); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading-text { font-size: 14px; font-weight: 600; color: var(--slate-600); }

    .result { display: none; margin-top: 30px; animation: slideUp 0.4s ease; }
    .result.active { display: block; }
    @keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

    .success-card { background: linear-gradient(135deg, var(--emerald-50), white); border: 2px solid var(--emerald-400); border-radius: 24px; overflow: hidden; }
    .success-header { background: linear-gradient(135deg, var(--emerald-600), var(--emerald-700)); padding: 25px 30px; display: flex; align-items: center; gap: 15px; }
    .success-icon { width: 55px; height: 55px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; color: var(--emerald-600); flex-shrink: 0; }
    .success-title h3 { font-size: 20px; font-weight: 900; color: white; margin-bottom: 2px; }
    .success-title p { font-size: 12px; color: var(--emerald-200); }
    .success-badge { margin-left: auto; background: rgba(255,255,255,0.2); padding: 6px 12px; border-radius: 15px; font-size: 10px; font-weight: 800; color: white; }

    .success-body { padding: 30px; }
    .info-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 25px; }
    .info-item { background: white; padding: 16px; border-radius: 14px; border: 1px solid var(--emerald-200); }
    .info-label { font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.06em; color: var(--emerald-700); margin-bottom: 6px; }
    .info-value { font-size: 14px; font-weight: 700; color: var(--slate-800); }

    .privacy-notice { background: #fef3c7; border: 1px solid #fcd34d; border-radius: 10px; padding: 10px 14px; margin-bottom: 18px; display: flex; align-items: center; gap: 8px; font-size: 11px; color: #92400e; }
    .privacy-notice::before { content: "üîí"; }

    .hash-section { background: white; border: 1px solid var(--emerald-200); border-radius: 14px; padding: 20px; margin-bottom: 20px; }
    .hash-label { font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.06em; color: var(--emerald-700); margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
    .hash-label::before { content: "üîê"; }
    .hash-value { font-family: 'JetBrains Mono'; font-size: 11px; color: var(--slate-600); word-break: break-all; line-height: 1.7; background: var(--slate-50); padding: 12px; border-radius: 8px; }

    .download-btn { width: 100%; padding: 18px; background: linear-gradient(135deg, var(--emerald-600), var(--emerald-700)); color: white; border: none; border-radius: 14px; font-size: 14px; font-weight: 800; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; }
    .download-btn:hover { transform: translateY(-2px); box-shadow: 0 12px 35px rgba(5,150,105,0.35); }

    .fail-card { background: linear-gradient(135deg, var(--red-50), white); border: 2px solid var(--red-500); border-radius: 24px; padding: 50px 30px; text-align: center; }
    .fail-icon { width: 75px; height: 75px; background: linear-gradient(135deg, var(--red-500), var(--red-600)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 36px; color: white; margin: 0 auto 20px; }
    .fail-card h3 { font-size: 22px; font-weight: 900; color: var(--red-700); margin-bottom: 10px; }
    .fail-card p { font-size: 14px; color: var(--slate-600); line-height: 1.5; max-width: 350px; margin: 0 auto; }

    #certHidden { position: fixed; left: -9999px; width: 800px; padding: 50px; background: white; font-family: 'Inter'; }
    .cert-border { border: 4px solid var(--emerald-600); border-radius: 20px; padding: 45px; }
    .cert-header { text-align: center; margin-bottom: 35px; padding-bottom: 25px; border-bottom: 2px solid var(--emerald-200); }
    .cert-logo { font-size: 12px; font-weight: 900; color: var(--emerald-700); letter-spacing: 0.1em; margin-bottom: 12px; }
    .cert-title { font-size: 30px; font-weight: 900; color: var(--slate-900); }
    .cert-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px; }
    .cert-field-label { font-size: 10px; font-weight: 800; color: var(--slate-400); text-transform: uppercase; margin-bottom: 4px; }
    .cert-field-value { font-size: 16px; font-weight: 700; color: var(--slate-800); }
    .cert-hash { background: var(--slate-100); padding: 18px; border-radius: 10px; margin-top: 20px; }
    .cert-hash-value { font-family: 'JetBrains Mono'; font-size: 10px; word-break: break-all; color: var(--slate-600); }
    .cert-footer { margin-top: 35px; display: flex; justify-content: space-between; align-items: flex-end; }
    .cert-stamp { width: 90px; height: 90px; border: 4px double var(--emerald-600); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 900; color: var(--emerald-600); transform: rotate(-15deg); }

    @media (max-width: 600px) { .input-row { flex-direction: column; } .search-btn { width: 100%; } .info-grid { grid-template-columns: 1fr; } .success-header { flex-direction: column; text-align: center; } .success-badge { margin: 10px 0 0 0; } }
  </style>
</head>
<body>

<div class="page-wrapper">
  <div class="main-card">
    <div class="drop-zone" id="dropZone">
      <div class="dz-icon">üìÇ</div>
      <div class="dz-title">Dosyayƒ± Buraya S√ºr√ºkleyin</div>
      <div class="dz-sub">SHA-512 parmak izi otomatik hesaplanƒ±r</div>
      <div class="dz-formats">
        <span class="format-tag">PDF</span>
        <span class="format-tag">PNG</span>
        <span class="format-tag">JPG</span>
        <span class="format-tag">MP4</span>
        <span class="format-tag">T√úM FORMATLAR</span>
      </div>
      <input type="file" id="fileInput" style="display:none">
    </div>

    <div class="divider"><span>VEYA</span></div>

    <div class="input-row">
      <input type="text" class="input-field" id="queryInput" placeholder="Sertifika ID, Eser Adƒ± veya Hash...">
      <button class="search-btn" id="searchBtn">SORGULA</button>
    </div>

    <div class="loading" id="loading"><div class="spinner"></div><div class="loading-text">Ar≈üiv taranƒ±yor...</div></div>

    <div class="result" id="successResult">
      <div class="success-card">
        <div class="success-header">
          <div class="success-icon">‚úì</div>
          <div class="success-title"><h3>M√úH√úRLENMƒ∞≈û VARLIK</h3><p>ƒ∞lhan Art Registry'de doƒürulandƒ±</p></div>
          <span class="success-badge">VERIFIED</span>
        </div>
        <div class="success-body">
          <div class="info-grid">
            <div class="info-item"><div class="info-label">Eser Adƒ±</div><div class="info-value" id="resTitle">-</div></div>
            <div class="info-item"><div class="info-label">Olu≈üturucu</div><div class="info-value" id="resCreator">-</div></div>
            <div class="info-item"><div class="info-label">Sertifika ID</div><div class="info-value" id="resCertId">-</div></div>
            <div class="info-item"><div class="info-label">Kayƒ±t Tarihi</div><div class="info-value" id="resDate">-</div></div>
            <div class="info-item"><div class="info-label">Origin B√∂lgesi</div><div class="info-value" id="resLocation">-</div></div>
            <div class="info-item"><div class="info-label">Cihaz</div><div class="info-value" id="resDevice">-</div></div>
          </div>
          <div class="privacy-notice"><span>Gizlilik koruma: IP adresleri KVKK/GDPR i√ßin maskelenmi≈ütir.</span></div>
          <div class="hash-section"><div class="hash-label">Dijital Parmak ƒ∞zi (SHA-512)</div><div class="hash-value" id="resHash">-</div></div>
          <button class="download-btn" id="downloadBtn">üìú SERTƒ∞Fƒ∞KAYI ƒ∞NDƒ∞R (PNG)</button>
        </div>
      </div>
    </div>

    <div class="result" id="failResult">
      <div class="fail-card">
        <div class="fail-icon">‚úó</div>
        <h3>M√úH√úRLENMEMƒ∞≈û</h3>
        <p>Bu dosya veya bilgi ƒ∞lhan Art Registry'de bulunamadƒ±.</p>
      </div>
    </div>
  </div>
</div>

<div id="certHidden">
  <div class="cert-border">
    <div class="cert-header"><div class="cert-logo">[POART] PROOF OF ART</div><div class="cert-title">Certificate of Authenticity</div></div>
    <div class="cert-grid">
      <div><div class="cert-field-label">Asset Title</div><div class="cert-field-value" id="certTitle">-</div></div>
      <div><div class="cert-field-label">Creator</div><div class="cert-field-value" id="certCreator">-</div></div>
      <div><div class="cert-field-label">Certificate ID</div><div class="cert-field-value" id="certId">-</div></div>
      <div><div class="cert-field-label">Date</div><div class="cert-field-value" id="certDate">-</div></div>
      <div><div class="cert-field-label">Origin Region</div><div class="cert-field-value" id="certLocation">-</div></div>
      <div><div class="cert-field-label">Device</div><div class="cert-field-value" id="certDevice">-</div></div>
    </div>
    <div class="cert-hash"><div class="cert-field-label">SHA-512 Hash</div><div class="cert-hash-value" id="certHash">-</div></div>
    <div class="cert-footer">
      <div><div style="font-size:11px;color:#64748b;">Verified by</div><div style="font-size:16px;font-weight:900;color:#1e293b;">ƒ∞lhan Art Gallery</div></div>
      <div class="cert-stamp">VALID<br>‚úì</div>
    </div>
  </div>
</div>

<script>
(function() {
  var SUPABASE_URL = 'https://immdfdvrwqcvgmflbgdr.supabase.co';
  var SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImltbWRmZHZyd3FjdmdtZmxiZ2RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc4NzU0MTgsImV4cCI6MjA4MzQ1MTQxOH0.MN05h2FLVFb14P9Oi0y3g3euqZjzGdVslJay6aQ1HkE';
  var client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY, { auth: { persistSession: false, autoRefreshToken: false, detectSessionInUrl: false } });

  var currentRecord = null;

  // üîí ADLƒ∞ MASKELEME (KVKK/GDPR)
  function maskIP(ip) { if (!ip || ip === 'Gizli' || ip === '-') return 'Korumalƒ±'; var p = ip.split('.'); return p.length === 4 ? p[0]+'.'+p[1]+'.***.***' : ip.substring(0,6)+'****'; }
  function maskLoc(loc) { if (!loc || loc === '-') return '-'; var p = loc.split(' / '); return p.length >= 2 ? '*** / ' + p.slice(1).join(' / ') : loc; }

  var dropZone = document.getElementById('dropZone'), fileInput = document.getElementById('fileInput');
  var queryInput = document.getElementById('queryInput'), searchBtn = document.getElementById('searchBtn');
  var loading = document.getElementById('loading'), successResult = document.getElementById('successResult'), failResult = document.getElementById('failResult');
  var downloadBtn = document.getElementById('downloadBtn');

  dropZone.addEventListener('click', function() { fileInput.click(); });
  dropZone.addEventListener('dragover', function(e) { e.preventDefault(); dropZone.classList.add('dragover'); });
  dropZone.addEventListener('dragleave', function() { dropZone.classList.remove('dragover'); });
  dropZone.addEventListener('drop', function(e) { e.preventDefault(); dropZone.classList.remove('dragover'); if (e.dataTransfer.files.length) processFile(e.dataTransfer.files[0]); });
  fileInput.addEventListener('change', function(e) { if (e.target.files.length) processFile(e.target.files[0]); });

  searchBtn.addEventListener('click', function() { var q = queryInput.value.trim(); if (q) performSearch(q); });
  queryInput.addEventListener('keypress', function(e) { if (e.key === 'Enter') searchBtn.click(); });
  downloadBtn.addEventListener('click', downloadCert);

  async function processFile(file) {
    showLoading('Dosya analiz ediliyor...');
    try {
      var buffer = await file.arrayBuffer();
      var hash = Array.from(new Uint8Array(await crypto.subtle.digest('SHA-512', buffer))).map(function(b){return b.toString(16).padStart(2,'0');}).join('');
      performSearch(hash);
    } catch(e) { hideLoading(); showFail(); }
  }

  async function performSearch(q) {
    showLoading('Ar≈üiv taranƒ±yor...');
    hideResults();
    try {
      var res = await client.from('manifests').select('*').or('cert_id.ilike.%'+q+'%,title.ilike.%'+q+'%,sha512.ilike.%'+q+'%,sha256.ilike.%'+q+'%').limit(1);
      if (res.error) throw res.error;
      if (res.data && res.data.length > 0) { currentRecord = res.data[0]; showSuccess(currentRecord); } else showFail();
    } catch(e) { showFail(); }
    hideLoading();
  }

  function showLoading(t) { loading.querySelector('.loading-text').textContent = t; loading.classList.add('active'); searchBtn.disabled = true; }
  function hideLoading() { loading.classList.remove('active'); searchBtn.disabled = false; }
  function hideResults() { successResult.classList.remove('active'); failResult.classList.remove('active'); }

  function showSuccess(d) {
    var mIP = maskIP(d.origin_ip), mLoc = maskLoc(d.location_data);
    document.getElementById('resTitle').textContent = d.title || 'ƒ∞simsiz';
    document.getElementById('resCreator').textContent = d.creator || '-';
    document.getElementById('resCertId').textContent = d.cert_id || '-';
    document.getElementById('resDate').textContent = formatDate(d.created_at);
    document.getElementById('resLocation').textContent = mIP + ' / ' + mLoc;
    document.getElementById('resDevice').textContent = d.device_info || '-';
    document.getElementById('resHash').textContent = d.sha512 || d.sha256 || '-';
    // Certificate
    document.getElementById('certTitle').textContent = d.title || 'ƒ∞simsiz';
    document.getElementById('certCreator').textContent = d.creator || '-';
    document.getElementById('certId').textContent = d.cert_id || '-';
    document.getElementById('certDate').textContent = formatDate(d.created_at);
    document.getElementById('certLocation').textContent = mIP + ' / ' + mLoc;
    document.getElementById('certDevice').textContent = d.device_info || '-';
    document.getElementById('certHash').textContent = d.sha512 || d.sha256 || '-';
    successResult.classList.add('active');
  }

  function showFail() { failResult.classList.add('active'); }
  function formatDate(s) { if (!s) return '-'; var d = new Date(s); return d.toLocaleDateString('tr-TR') + ' ' + d.toLocaleTimeString('tr-TR',{hour:'2-digit',minute:'2-digit'}); }

  async function downloadCert() {
    if (!currentRecord) return;
    try { var canvas = await html2canvas(document.getElementById('certHidden'),{scale:2,useCORS:true}); var link = document.createElement('a'); link.download = 'CERT-'+(currentRecord.cert_id||'POART')+'.png'; link.href = canvas.toDataURL('image/png'); link.click(); } catch(e) { alert('Sertifika indirilemedi.'); }
  }
})();
</script>
</body>
</html>
