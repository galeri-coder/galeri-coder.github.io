<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PoArt Dijital Sertifika v1.6</title>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">

  <style>
    body {
      background: linear-gradient(135deg, #ecfdf5, #f0fdfa);
      font-family: 'Inter', sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      padding: 30px;
    }

    .card {
      background: rgba(255, 255, 255, 0.8);
      border-radius: 25px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.1);
      padding: 40px;
      width: 100%;
      max-width: 900px;
      backdrop-filter: blur(12px);
      transition: 0.3s;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 25px 80px rgba(0,0,0,0.12);
    }

    h1 {
      text-align: center;
      color: #064e3b;
      font-weight: 900;
      margin-bottom: 30px;
    }

    input, select, button {
      width: 100%;
      padding: 15px;
      border-radius: 12px;
      border: 2px solid #e2e8f0;
      margin-bottom: 15px;
      font-size: 15px;
      transition: 0.3s;
    }

    input:focus {
      border-color: #10b981;
      box-shadow: 0 0 0 4px rgba(16,185,129,0.1);
      outline: none;
    }

    button {
      background: linear-gradient(135deg, #059669, #10b981);
      color: white;
      font-weight: 700;
      cursor: pointer;
      border: none;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(16,185,129,0.3);
    }

    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
      color: #334155;
      margin-bottom: 10px;
    }

    .output {
      margin-top: 20px;
      background: #ecfdf5;
      border-radius: 12px;
      padding: 20px;
      border: 1px solid #a7f3d0;
      display: none;
    }

    .hash-block {
      background: #f8fafc;
      border-radius: 10px;
      padding: 12px;
      font-family: monospace;
      font-size: 12px;
      word-break: break-all;
      margin-top: 10px;
    }

    #qrcode {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }
  </style>
</head>

<body>
  <div class="card">
    <h1>ðŸ“œ Dijital Sertifika OluÅŸtur</h1>

    <input type="text" id="title" placeholder="Eser AdÄ± (Ã¶r. Sonsuzluk)">
    <input type="text" id="creator" placeholder="OluÅŸturucu (Ã¶r. Ä°lhan Art)">
    <input type="file" id="fileInput">

    <div class="checkbox-row">
      <input type="checkbox" id="maskOption">
      <label for="maskOption">IP ve Konumum maskelensin (isteÄŸe baÄŸlÄ±)</label>
    </div>

    <button id="generate">Sertifika OluÅŸtur</button>

    <div class="output" id="output">
      <h3>âœ… Sertifika OluÅŸturuldu</h3>
      <p><strong>Sertifika ID:</strong> <span id="certId"></span></p>
      <div class="hash-block">SHA-256: <span id="sha256"></span></div>
      <div class="hash-block">SHA-512: <span id="sha512"></span></div>
      <div id="qrcode"></div>
      <button id="downloadCert">ðŸ“„ SertifikayÄ± Ä°ndir (PNG)</button>
      <button id="downloadJson">ðŸ’¾ JSON Verisini Ä°ndir</button>
    </div>
  </div>

  <div id="certHidden" style="position:absolute; left:-9999px;"></div>

<script>
const SUPABASE_URL = "https://immdfdvrwqcvgmflbgdr.supabase.co";
const SERVICE_KEY = "âš ï¸BURAYA SERVICE ROLE KEY GELECEKâš ï¸"; // RLS korumalÄ± key
const client = supabase.createClient(SUPABASE_URL, SERVICE_KEY);

async function hashFile(file, algorithm = "SHA-512") {
  const buffer = await file.arrayBuffer();
  const digest = await crypto.subtle.digest(algorithm, buffer);
  return Array.from(new Uint8Array(digest)).map(b => b.toString(16).padStart(2, "0")).join("");
}

document.getElementById("generate").onclick = async () => {
  const file = document.getElementById("fileInput").files[0];
  if (!file) return alert("LÃ¼tfen bir dosya seÃ§in!");

  const title = document.getElementById("title").value || "Ä°simsiz Eser";
  const creator = document.getElementById("creator").value || "Bilinmiyor";
  const mask = document.getElementById("maskOption").checked;

  // Hash oluÅŸtur
  const sha256 = await hashFile(file, "SHA-256");
  const sha512 = await hashFile(file, "SHA-512");
  const certId = "POART-" + Math.random().toString(36).substring(2,10).toUpperCase();

  // IP/konum maskesi (yalnÄ±zca kullanÄ±cÄ± istemiÅŸse)
  const loc = mask ? "Anonim / ***" : "Gizli";

  // Supabase'e kaydet
  const manifest = {
    cert_id: certId,
    title,
    creator,
    sha256,
    sha512,
    device_info: navigator.platform || "Web",
    location_data: loc,
    origin_ip: "KorumalÄ±",
    visibility: "public"
  };

  const { data, error } = await client.from("manifests").insert([manifest]);
  if (error) console.error(error);

  // GÃ¶rsel Ã§Ä±ktÄ±lar
  document.getElementById("output").style.display = "block";
  document.getElementById("certId").textContent = certId;
  document.getElementById("sha256").textContent = sha256;
  document.getElementById("sha512").textContent = sha512;

  document.getElementById("qrcode").innerHTML = "";
  new QRCode(document.getElementById("qrcode"), {
    text: `https://galeri-coder.github.io/verify.html?q=${encodeURIComponent(certId)}`,
    width: 128, height: 128, colorDark: "#059669"
  });

  // Sertifika PNG indir
  document.getElementById("downloadCert").onclick = async () => {
    const clone = document.getElementById("output").cloneNode(true);
    clone.style.display = "block";
    document.getElementById("certHidden").innerHTML = "";
    document.getElementById("certHidden").appendChild(clone);
    const canvas = await html2canvas(clone, { scale: 2 });
    const link = document.createElement("a");
    link.download = `${certId}.png`;
    link.href = canvas.toDataURL("image/png");
    link.click();
  };

  // JSON indir
  document.getElementById("downloadJson").onclick = () => {
    const json = JSON.stringify(manifest, null, 2);
    const blob = new Blob([json], { type: "application/json" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = `${certId}.json`;
    link.click();
  };
};
</script>
</body>
</html>
